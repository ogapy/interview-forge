# Interview Forge 実装戦略ドキュメント

## 📊 概要

このドキュメントは、Interview Forge プロジェクトの実装順序と優先度付けの戦略を定義します。
仕様書と現在の技術スタックの差分を基に、効率的な開発を実現するための指針を提供します。

## 🎯 優先度分類

### High Priority (優先度 2) - 基盤となる必須機能
コアシステムの基盤となる、絶対に必要な機能群。これらなしには他の機能が動作しない。

| Issue ID | タスク名 | プロジェクト |
|----------|---------|------------|
| IF-13 | PostgreSQLのローカル環境構築 | データベース基盤構築 |
| IF-14 | Prismaの初期セットアップと設定 | データベース基盤構築 |
| IF-15 | usersテーブルのスキーマ定義 | データベース基盤構築 |
| IF-19 | problemsテーブルのスキーマ定義 | データベース基盤構築 |
| IF-20 | answersテーブルのスキーマ定義 | データベース基盤構築 |
| IF-16 | tRPCの初期セットアップ | API層実装 |
| IF-17 | OpenAI SDKの初期セットアップ | LLM統合システム |
| IF-18 | NextAuth.jsの初期セットアップ | 認証システム実装 |

### Medium Priority (優先度 3) - コア機能の実装
MVPとして必要な主要機能。基盤の上に構築される実装部分。

| Issue ID | タスク名 | プロジェクト |
|----------|---------|------------|
| IF-11 | Bunランタイムのセットアップ | Bun ランタイム導入 |
| IF-12 | package.jsonスクリプトの更新 | Bun ランタイム導入 |
| IF-23 | ユーザー関連のtRPCルーター | API層実装 |
| IF-24 | 問題生成のtRPCルーター | API層実装 |
| IF-25 | 回答・採点のtRPCルーター | API層実装 |
| IF-28 | 問題生成プロンプトの実装 | LLM統合システム |
| IF-29 | 採点プロンプトの実装 | LLM統合システム |
| IF-31 | GitHub OAuth provider設定 | 認証システム実装 |
| IF-32 | セッション管理の実装 | 認証システム実装 |

### Low Priority (優先度 4) - 拡張機能と最適化
MVP完成後に追加する拡張機能や最適化。初期リリースには不要。

| Issue ID | タスク名 | プロジェクト |
|----------|---------|------------|
| IF-21 | review_queueテーブルのスキーマ定義 | データベース基盤構築 |
| IF-22 | promptsテーブルのスキーマ定義 | データベース基盤構築 |
| IF-26 | 復習機能のtRPCルーター | API層実装 |
| IF-27 | Langfuseの導入 | LLM統合システム |
| IF-30 | プロンプトバージョン管理 | LLM統合システム |
| IF-33 | 保護されたルートの実装 | 認証システム実装 |

## 📅 実装フェーズと順序

### Phase 1: データベース基盤構築（1-5）
**目的**: データ永続化層の確立

1. **IF-13**: PostgreSQLのローカル環境構築
   - Docker Composeでデータベース環境を整備
   - 開発環境の標準化

2. **IF-14**: Prismaの初期セットアップ
   - ORMツールの導入
   - 型安全なデータベース操作の基盤

3. **IF-15**: usersテーブルのスキーマ定義
   - ユーザー管理の基本構造
   - 認証システムとの連携準備

4. **IF-19**: problemsテーブルのスキーマ定義
   - 問題データの管理構造
   - LLM生成問題の永続化

5. **IF-20**: answersテーブルのスキーマ定義
   - 回答と採点結果の保存
   - 学習履歴の追跡

### Phase 2: 認証システム構築（6-8）
**目的**: セキュアなユーザー管理

6. **IF-18**: NextAuth.jsの初期セットアップ
   - 認証基盤の構築
   - セッション管理の準備

7. **IF-31**: GitHub OAuth provider設定
   - 開発者向けの簡単なログイン
   - ソーシャル認証の実装

8. **IF-32**: セッション管理の実装
   - ログイン状態の維持
   - クライアント・サーバー間の認証情報共有

### Phase 3: API基盤構築（9-10）
**目的**: フロントエンド・バックエンド連携

9. **IF-16**: tRPCの初期セットアップ
   - 型安全なAPI通信
   - エンドツーエンドの型定義

10. **IF-23**: ユーザー関連のtRPCルーター
    - プロフィール管理API
    - ユーザー情報の取得・更新

### Phase 4: LLM統合実装（11-15）
**目的**: AI機能のコア実装

11. **IF-17**: OpenAI SDKの初期セットアップ
    - LLM APIの統合
    - 基本的な呼び出し機能

12. **IF-28**: 問題生成プロンプトの実装
    - 高品質な問題生成ロジック
    - カテゴリ・難易度別の調整

13. **IF-29**: 採点プロンプトの実装
    - 詳細なフィードバック生成
    - ルーブリックベースの評価

14. **IF-24**: 問題生成のtRPCルーター
    - 問題取得・生成API
    - キャッシュ戦略の実装

15. **IF-25**: 回答・採点のtRPCルーター
    - 回答提出と自動採点
    - 学習履歴の記録

### Phase 5: 開発効率化（16-17）
**目的**: 高速な開発環境

16. **IF-11**: Bunランタイムのセットアップ
    - 高速な実行環境
    - ビルド時間の短縮

17. **IF-12**: package.jsonスクリプトの更新
    - Bun対応のスクリプト
    - 開発フローの最適化

### Phase 6: 拡張機能実装（18-23）
**目的**: 付加価値機能の追加

18. **IF-21**: review_queueテーブルのスキーマ定義
    - 復習機能の基盤
    - 間隔学習の準備

19. **IF-26**: 復習機能のtRPCルーター
    - 復習キュー管理
    - SM-2アルゴリズム実装

20. **IF-22**: promptsテーブルのスキーマ定義
    - プロンプト管理構造
    - バージョニング対応

21. **IF-30**: プロンプトバージョン管理
    - A/Bテスト機能
    - 継続的な改善基盤

22. **IF-27**: Langfuseの導入
    - LLM使用状況の監視
    - コスト最適化

23. **IF-33**: 保護されたルートの実装
    - アクセス制御の強化
    - セキュリティ向上

## 🎯 実装戦略の根拠

### 1. データベース優先の理由
- **依存関係の解決**: 全機能がデータ永続化に依存
- **スキーマファースト**: 型定義の基準となる
- **開発効率**: Prismaの型生成により後続開発が効率化

### 2. 認証システムの早期実装
- **セキュリティ**: 早期にセキュアな環境を確立
- **マルチユーザー対応**: 将来の公開に向けた準備
- **API保護**: 認証済みユーザーのみAPIアクセス可能

### 3. API層の重要性
- **型安全性**: tRPCによるエンドツーエンドの型保証
- **開発体験**: 自動補完とコンパイル時エラー検出
- **メンテナンス性**: 変更に強い設計

### 4. LLM機能の段階的実装
- **コア価値**: アプリケーションの主要機能
- **イテレーション**: プロンプトの継続的改善
- **コスト管理**: 使用量の監視と最適化

### 5. Bun導入のタイミング
- **リスク管理**: 基本機能の動作確認後に導入
- **比較検証**: Node.jsとの性能比較が可能
- **段階的移行**: 問題があれば即座に戻せる

### 6. 拡張機能の後回し
- **MVP優先**: 最小限の機能で早期リリース
- **フィードバック**: ユーザー反応を見てから追加
- **技術的負債回避**: 不要な機能の実装を防ぐ

## 📈 成功指標

### Phase完了の定義
- **Phase 1**: 全テーブルでCRUD操作が可能
- **Phase 2**: GitHubログインが機能
- **Phase 3**: APIエンドポイントが疎通
- **Phase 4**: 問題生成と採点が動作
- **Phase 5**: Bunで全機能が動作
- **Phase 6**: 全拡張機能が統合完了

### リスクと対策
| リスク | 対策 |
|-------|------|
| LLMコストの増大 | 早期にLangfuse導入を検討 |
| 認証の複雑化 | NextAuth.jsの標準設定を活用 |
| Bun互換性問題 | Node.js環境を維持、段階的移行 |
| スキーマ変更の影響 | Prismaマイグレーションで管理 |

## 🚀 次のステップ

1. **即座に開始**: IF-13 PostgreSQL環境構築
2. **並行作業可能**: 
   - データベース設計の詳細化
   - 認証フローの設計
   - プロンプトテンプレートの作成
3. **早期検証項目**:
   - OpenAI APIキーの取得
   - GitHub OAuth Appの作成
   - Dockerの動作確認

## 📝 メモ

- 各フェーズは基本的に順序通りに実装するが、Phase内のタスクは並行実行可能
- 優先度Highのタスクでブロッカーが発生した場合は、即座に対応
- 各Phase完了時に動作確認とコードレビューを実施
- ドキュメント更新は各タスク完了時に随時実施

---

*このドキュメントは実装の進捗に応じて更新されます。*
*最終更新: 2025-08-10*